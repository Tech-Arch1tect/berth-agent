services:
  berth-agent:
    image: techarchitect/berth-agent:latest
    build: .
    container_name: berth-agent
    environment:
      - ACCESS_TOKEN=${ACCESS_TOKEN}
      - PORT=${PORT:-8080}
      - STACK_LOCATION=${STACK_LOCATION:-/opt/compose}
    ports:
      - "${PORT:-8080}:${PORT:-8080}"
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - /sys/fs/cgroup:/sys/fs/cgroup:ro
      - /proc:/proc:ro
      - ${STACK_LOCATION:-/opt/compose}:${STACK_LOCATION:-/opt/compose}
      - ./ssl:/app/ssl
      - ./logs/agent/:/var/log/berth-agent/

  berth-updater:
    image: techarchitect/berth-agent:latest
    build: .
    container_name: berth-updater
    environment:
      - ACCESS_TOKEN=${ACCESS_TOKEN}
    command: ["./berth-agent", "sidecar"]
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - ${STACK_LOCATION:-/opt/compose}:${STACK_LOCATION:-/opt/compose}
      - ./ssl:/app/ssl
      - ./logs/sidecar/:/var/log/berth-agent/
    restart: unless-stopped
